var N=Object.defineProperty;var q=(e,t,r)=>t in e?N(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var g=(e,t,r)=>(q(e,typeof t!="symbol"?t+"":t,r),r),$=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var a=(e,t,r)=>($(e,t,"read from private field"),r?r.call(e):t.get(e)),l=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},u=(e,t,r,n)=>($(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);class A extends Error{constructor(r,n,s){super(s);g(this,"url");g(this,"status");g(this,"statusText");g(this,"body");g(this,"request");this.name="ApiError",this.url=n.url,this.status=n.status,this.statusText=n.statusText,this.body=n.body,this.request=r}}class H extends Error{constructor(t){super(t),this.name="CancelError"}get isCancelled(){return!0}}var y,f,h,b,p,w,S;class P{constructor(t){l(this,y,void 0);l(this,f,void 0);l(this,h,void 0);l(this,b,void 0);l(this,p,void 0);l(this,w,void 0);l(this,S,void 0);u(this,y,!1),u(this,f,!1),u(this,h,!1),u(this,b,[]),u(this,p,new Promise((r,n)=>{u(this,w,r),u(this,S,n);const s=c=>{var d;a(this,y)||a(this,f)||a(this,h)||(u(this,y,!0),(d=a(this,w))==null||d.call(this,c))},o=c=>{var d;a(this,y)||a(this,f)||a(this,h)||(u(this,f,!0),(d=a(this,S))==null||d.call(this,c))},i=c=>{a(this,y)||a(this,f)||a(this,h)||a(this,b).push(c)};return Object.defineProperty(i,"isResolved",{get:()=>a(this,y)}),Object.defineProperty(i,"isRejected",{get:()=>a(this,f)}),Object.defineProperty(i,"isCancelled",{get:()=>a(this,h)}),t(s,o,i)}))}get[Symbol.toStringTag](){return"Cancellable Promise"}then(t,r){return a(this,p).then(t,r)}catch(t){return a(this,p).catch(t)}finally(t){return a(this,p).finally(t)}cancel(){var t;if(!(a(this,y)||a(this,f)||a(this,h))){if(u(this,h,!0),a(this,b).length)try{for(const r of a(this,b))r()}catch(r){console.warn("Cancellation threw an error",r);return}a(this,b).length=0,(t=a(this,S))==null||t.call(this,new H("Request aborted"))}}get isCancelled(){return a(this,h)}}y=new WeakMap,f=new WeakMap,h=new WeakMap,b=new WeakMap,p=new WeakMap,w=new WeakMap,S=new WeakMap;const j=e=>e!=null,E=e=>typeof e=="string",C=e=>E(e)&&e!=="",R=e=>typeof e=="object"&&typeof e.type=="string"&&typeof e.stream=="function"&&typeof e.arrayBuffer=="function"&&typeof e.constructor=="function"&&typeof e.constructor.name=="string"&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag]),B=e=>e instanceof FormData,F=e=>{try{return btoa(e)}catch{return Buffer.from(e).toString("base64")}},I=e=>{const t=[],r=(s,o)=>{t.push(`${encodeURIComponent(s)}=${encodeURIComponent(String(o))}`)},n=(s,o)=>{j(o)&&(Array.isArray(o)?o.forEach(i=>{n(s,i)}):typeof o=="object"?Object.entries(o).forEach(([i,c])=>{n(`${s}[${i}]`,c)}):r(s,o))};return Object.entries(e).forEach(([s,o])=>{n(s,o)}),t.length>0?`?${t.join("&")}`:""},U=(e,t)=>{const r=e.ENCODE_PATH||encodeURI,n=t.url.replace("{api-version}",e.VERSION).replace(/{(.*?)}/g,(o,i)=>{var c;return(c=t.path)!=null&&c.hasOwnProperty(i)?r(String(t.path[i])):o}),s=`${e.BASE}${n}`;return t.query?`${s}${I(t.query)}`:s},J=e=>{if(e.formData){const t=new FormData,r=(n,s)=>{E(s)||R(s)?t.append(n,s):t.append(n,JSON.stringify(s))};return Object.entries(e.formData).filter(([n,s])=>j(s)).forEach(([n,s])=>{Array.isArray(s)?s.forEach(o=>r(n,o)):r(n,s)}),t}},T=async(e,t)=>typeof t=="function"?t(e):t,W=async(e,t)=>{const r=await T(t,e.TOKEN),n=await T(t,e.USERNAME),s=await T(t,e.PASSWORD),o=await T(t,e.HEADERS),i=Object.entries({Accept:"application/json",...o,...t.headers}).filter(([c,d])=>j(d)).reduce((c,[d,m])=>({...c,[d]:String(m)}),{});if(C(r)&&(i.Authorization=`Bearer ${r}`),C(n)&&C(s)){const c=F(`${n}:${s}`);i.Authorization=`Basic ${c}`}return t.body&&(t.mediaType?i["Content-Type"]=t.mediaType:R(t.body)?i["Content-Type"]=t.body.type||"application/octet-stream":E(t.body)?i["Content-Type"]="text/plain":B(t.body)||(i["Content-Type"]="application/json")),new Headers(i)},_=e=>{var t;if(e.body!==void 0)return(t=e.mediaType)!=null&&t.includes("/json")?JSON.stringify(e.body):E(e.body)||R(e.body)||B(e.body)?e.body:JSON.stringify(e.body)},z=async(e,t,r,n,s,o,i)=>{const c=new AbortController,d={headers:o,body:n??s,method:t.method,signal:c.signal};return e.WITH_CREDENTIALS&&(d.credentials=e.CREDENTIALS),i(()=>c.abort()),await fetch(r,d)},L=(e,t)=>{if(t){const r=e.headers.get(t);if(E(r))return r}},k=async e=>{if(e.status!==204)try{const t=e.headers.get("Content-Type");if(t)return["application/json","application/problem+json"].some(s=>t.toLowerCase().startsWith(s))?await e.json():await e.text()}catch(t){console.error(t)}},G=(e,t)=>{const n={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",...e.errors}[t.status];if(n)throw new A(e,t,n);if(!t.ok){const s=t.status??"unknown",o=t.statusText??"unknown",i=(()=>{try{return JSON.stringify(t.body,null,2)}catch{return}})();throw new A(e,t,`Generic Error: status: ${s}; status text: ${o}; body: ${i}`)}},K=(e,t)=>new P(async(r,n,s)=>{try{const o=U(e,t),i=J(t),c=_(t),d=await W(e,t);if(!s.isCancelled){const m=await z(e,t,o,c,i,d,s),D=await k(m),x=L(m,t.responseHeader),O={url:o,ok:m.ok,status:m.status,statusText:m.statusText,body:x??D};G(t,O),r(O.body)}}catch(o){n(o)}});export{K as r};
